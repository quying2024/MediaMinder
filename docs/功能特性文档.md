# MediaMinder 功能特性文档

## 功能概述

MediaMinder是一个智能相机照片管理工具，提供自动相机检测、照片下载、展示和备份清理等完整功能。本文档详细描述了系统的各项功能特性。

## 核心功能

### 1. 智能相机识别

#### 1.1 多品牌支持
MediaMinder支持34个主流相机品牌和系列：

**Canon系列**
- Canon G16, EOS, PowerShot, Digital
- 支持所有Canon数码相机

**Nikon系列**
- NIKON, NIKON D, NIKON Z, NIKON COOLPIX
- 支持D系列单反、Z系列微单、COOLPIX系列

**Sony系列**
- Sony, SONY, Sony DSC, Sony α, Sony ILCE
- 支持α系列、ILCE系列等

**其他品牌**
- FUJIFILM, Fujifilm, X-T, X-E, X-Pro
- Panasonic, PANASONIC, LUMIX, DMC-
- Olympus, OLYMPUS, OM-D, PEN
- Leica, LEICA, Pentax, PENTAX, Ricoh, RICOH

#### 1.2 识别机制
- **卷标名匹配**: 基于驱动器卷标名进行品牌识别
- **DCIM结构验证**: 检查DCIM目录结构
- **文件扩展名验证**: 验证相机文件扩展名
- **照片数量检查**: 可配置最小照片数量要求

#### 1.3 连接优化
- **设备插入冷却**: 防止短时间内重复处理同一设备
- **连接质量检查**: 多次检查设备连接稳定性
- **设备黑名单**: 自动屏蔽有问题的设备
- **设备状态跟踪**: 记录设备插入历史和失败次数

### 2. 自动照片下载

#### 2.1 智能下载策略
- **最新目录优先**: 只下载DCIM目录中最新生成的子目录
- **目录时间排序**: 按创建/修改时间排序选择最新目录
- **相机命名识别**: 识别典型的相机目录命名模式（如100CANON）

#### 2.2 下载验证机制
- **文件存在性验证**: 确保所有文件都成功复制
- **文件大小验证**: 验证源文件和目标文件大小一致
- **文件哈希验证**: 可选的文件内容哈希验证（MD5）
- **重试机制**: 验证失败时自动重试

#### 2.3 源文件管理
- **自动删除**: 下载验证成功后自动删除相机中的源文件
- **删除确认**: 可配置的删除确认延迟
- **删除通知**: 发送源文件删除完成通知

### 3. 照片展示界面

#### 3.1 界面特性
- **自适应尺寸**: 按屏幕80%尺寸打开，适应不同分辨率
- **无限滚动**: 支持显示任意数量照片，自动显示滚动条
- **3列网格布局**: 整齐的照片网格显示
- **固定照片尺寸**: 200x200像素的缩略图

#### 3.2 交互功能
- **双击打开**: 双击照片使用Photoshop或默认程序打开
- **Photoshop优先**: 智能检测并优先使用Photoshop打开
- **文件夹访问**: 一键打开照片文件夹
- **实时更新**: 新照片自动刷新显示

#### 3.3 加载优化
- **异步加载**: 图片异步加载，不阻塞UI
- **内存管理**: 动态创建和销毁PictureBox控件
- **错误处理**: 加载失败时显示友好提示

### 4. 备份清理系统

#### 4.1 自动备份
- **触发时机**: 用户关闭展示窗口时自动触发
- **时间戳目录**: 创建格式为`Backup_yyyyMMdd_HHmmss`的备份目录
- **完整备份**: 备份根目录中的所有图片文件
- **重名处理**: 自动处理重名文件，添加序号

#### 4.2 备份验证
- **完整性检查**: 验证备份文件的完整性
- **文件大小验证**: 确保备份文件大小正确
- **存在性验证**: 确保所有文件都成功备份

#### 4.3 智能清理
- **根目录清理**: 删除根目录中的所有图片文件
- **占用文件跳过**: 跳过被其他程序占用的文件，不重试
- **过期目录清理**: 自动清理超过1周的备份目录
- **独立进程**: 使用独立进程避免文件句柄占用

### 5. 进程间通信

#### 5.1 通信机制
- **命名管道**: 使用Windows命名管道进行高效通信
- **双向通信**: 支持服务端和客户端双向通信
- **异步处理**: 所有通信都是异步的，不阻塞操作

#### 5.2 消息类型
- **状态更新**: 服务状态变化通知
- **新照片通知**: 检测到新照片时的通知
- **相机事件**: 相机插入、识别、下载等事件
- **源文件删除**: 源文件删除完成通知

#### 5.3 连接管理
- **自动重连**: 连接断开时自动重连
- **超时处理**: 连接超时和消息超时处理
- **错误恢复**: 通信错误时的恢复机制

## 高级功能

### 1. 配置管理

#### 1.1 强类型配置
- **配置模型**: 使用强类型配置模型
- **配置验证**: 配置项验证和默认值
- **热重载**: 支持配置热重载（开发模式）

#### 1.2 配置项
- **相机识别配置**: 品牌前缀、验证选项等
- **连接优化配置**: 冷却时间、重试次数等
- **下载配置**: 验证选项、删除选项等
- **显示配置**: 缩略图大小、支持格式等

### 2. 日志系统

#### 2.1 结构化日志
- **Serilog**: 使用Serilog结构化日志
- **多输出**: 同时输出到文件和控制台
- **日志级别**: 可配置的日志级别

#### 2.2 日志内容
- **操作日志**: 记录所有重要操作
- **错误日志**: 记录异常和错误信息
- **调试日志**: 详细的调试信息
- **性能日志**: 性能相关指标

### 3. 错误处理

#### 3.1 异常处理
- **全局异常**: 服务级别的异常捕获
- **资源释放**: 异常时的资源清理
- **错误恢复**: 自动错误恢复机制

#### 3.2 用户反馈
- **友好提示**: 用户友好的错误提示
- **操作指导**: 错误时的操作建议
- **状态显示**: 实时状态显示

### 4. 性能优化

#### 4.1 内存优化
- **对象重用**: 重用PictureBox对象
- **及时释放**: 及时释放图片资源
- **垃圾回收**: 优化GC压力

#### 4.2 文件操作优化
- **批量处理**: 批量文件操作
- **异步IO**: 异步文件读写
- **缓存策略**: 智能缓存机制

## 支持的文件格式

### 1. 图片格式
- **JPEG**: .jpg, .jpeg
- **PNG**: .png
- **GIF**: .gif
- **BMP**: .bmp
- **TIFF**: .tiff, .tif

### 2. 相机原始格式
- **Canon**: .CR2
- **Nikon**: .NEF
- **Sony**: .ARW
- **通用**: .RAW, .DNG

## 系统要求

### 1. 操作系统
- **Windows 10**: 版本1903或更高
- **Windows 11**: 所有版本
- **Windows Server**: 2019或更高

### 2. 运行时环境
- **.NET 9.0 Runtime**: 必需
- **.NET 9.0 SDK**: 开发环境需要

### 3. 硬件要求
- **内存**: 最少4GB，推荐8GB
- **存储**: 最少1GB可用空间
- **USB端口**: 用于连接相机

## 安全特性

### 1. 数据安全
- **文件完整性**: 下载后验证文件完整性
- **备份安全**: 备份文件完整性验证
- **临时文件清理**: 自动清理所有临时文件

### 2. 权限管理
- **最小权限**: 使用最小必要权限
- **用户隔离**: 不同用户的数据隔离
- **访问控制**: 适当的文件访问控制

### 3. 隐私保护
- **本地处理**: 所有处理都在本地进行
- **无网络传输**: 不涉及网络数据传输
- **数据保留**: 可配置的数据保留策略

## 扩展性

### 1. 相机品牌扩展
- **配置驱动**: 通过配置文件添加新品牌
- **插件支持**: 支持插件方式扩展
- **动态识别**: 支持动态识别新品牌

### 2. 功能扩展
- **消息系统**: 可扩展的消息类型
- **配置扩展**: 可扩展的配置项
- **UI扩展**: 可扩展的用户界面

### 3. 集成扩展
- **API接口**: 可选的API接口
- **第三方集成**: 支持第三方工具集成
- **云存储**: 可选的云存储支持

## 性能指标

### 1. 响应时间
- **相机检测**: < 3秒
- **照片下载**: 根据文件大小和数量
- **UI响应**: < 100ms
- **备份操作**: 根据文件数量

### 2. 资源使用
- **内存使用**: < 100MB（正常使用）
- **CPU使用**: < 5%（空闲时）
- **磁盘IO**: 优化的批量操作

### 3. 稳定性
- **运行时间**: 支持7x24小时运行
- **错误恢复**: 自动错误恢复
- **数据完整性**: 100%数据完整性保证

## 总结

MediaMinder提供了完整的相机照片管理解决方案，具有以下特点：

1. **功能完整**: 从相机检测到照片展示的完整流程
2. **智能化**: 智能相机识别和自动下载
3. **用户友好**: 直观的界面和自动化操作
4. **高可靠**: 全面的错误处理和恢复机制
5. **高性能**: 优化的性能和资源使用
6. **可扩展**: 易于扩展和定制

这些功能特性使MediaMinder成为一个专业级的相机照片管理工具，能够满足专业用户的需求。
